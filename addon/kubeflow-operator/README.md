# KubeFlow Addon for Kubermatic Kubernetes Platform
This is a KubeFlow [addon for Kubermatic Kubernetes Platform](https://docs.kubermatic.com/kubermatic/master/advanced/addons/).

The KubeFlow addon provides the following optional config options:
- `DashboardURI` (string): URI (domain name or IP address) that will be used to access the KubeFlow dashboard. If using a domain name, make sure to set up you DNS accordingly.
- `IstioIngressGatewayServiceType` (string): Type of the istioingressgateway service, used to access KubeFlow dashboard. It can be set to `ClusterIP`, `NodePort` or `LoadBalancer`.
- `OIDCProviderURL` (string): URL of external OIDC provider, e.g. Kubermatic Dex instance. Make sure that `DashboardURI` is specified if you are using this. If not specified, no authentication is used (very insecure!).
- `OIDCSecret` (string): Secret string shared between the OIDC provider and KubeFlow. If not provided, [this default](https://github.com/kubeflow/manifests/blob/master/istio/oidc-authservice/base/params.env#L5) is used (insecure!).

## Example Addon Resources
For the KubeFlow addon:
```yaml
apiVersion: kubermatic.k8s.io/v1
kind: Addon
metadata:
  name: kubeflow-operator
  namespace: cluster-bjg9qmhctj
  ownerReferences:
  - apiVersion: kubermatic.k8s.io/v1
    blockOwnerDeletion: true
    controller: true
    kind: Cluster
    name: bjg9qmhctj
    uid: 30c13f8b-235e-4512-8673-d9b0f3a41f27
spec:
  cluster:
    kind: Cluster
    name: bjg9qmhctj
    uid: 30c13f8b-235e-4512-8673-d9b0f3a41f27
  name: kubeflow-operator
  variables:
    {
      "DashboardURI": "kubeflow.mydomain.io",
      "IstioIngressGatewayServiceType": "LoadBalancer",
      "OIDCProviderURL": "https://dev.kubermatic.io/dex",
      "OIDCSecret": "NQh4P9fIDlEyI6EMKW66TLKLdcIStT4C02"
    }
```

## OIDC Provider Configuration
The plugin allows pointing to an external OIDC provider of user's choice. To have OIDC working, the provider itself needs to be configured as well - e.g. in case it is a Dex instance, a `staticClients` entry needs to be added:
```yaml
  staticClients:
    - RedirectURIs:
        - http://kubeflow.mydomain.io/login/oidc
      id: kubeflow-oidc-authservice
      name: kubeflow-oidc-authservice
      secret: NQh4P9fIDlEyI6EMKW66TLKLdcIStT4C02
```

## Addon Maintenance
The manifest.yaml file contains three parts:
- A namespace to deploy KubeFlow operator.
- Manifest of KubeFlow operator, which can be generated by following [KubeFlow operator page](https://github.com/kubermatic/kfctl/blob/master/operator.md#deployment-instructions)
- A KfDef which is used to config KubeFlow installation.
